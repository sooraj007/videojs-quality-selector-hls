/*! @name videojs-quality-selector-hls @version 1.1.1 @license MIT */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).videojsQualitySelectorHls=e(t.videojs)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=e(t);const l=i.default.getComponent("MenuButton"),s=i.default.getComponent("Menu"),n=i.default.getComponent("Component"),u=i.default.dom;function a(t){return new l(t,{title:t.localize("Quality"),name:"QualityButton",createItems:()=>[],createMenu:()=>{const t=new s(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){const i=u.createEl("li",{className:"vjs-menu-title",innerHTML:(e=this.options_.title,"string"!=typeof e?e:e.charAt(0).toUpperCase()+e.slice(1)),tabIndex:-1}),l=new n(this.player_,{el:i});this.hideThreshold_+=1,t.addItem(l)}var e;if(this.items=this.createItems(),this.items)for(let e=0;e<this.items.length;e++)t.addItem(this.items[e]);return t}})}const o=i.default.getComponent("MenuItem");const r={vjsIconClass:"vjs-icon-hd",displayCurrentQuality:!1,placementIndex:0};class h{constructor(t,e){this.player=t,this.config=i.default.obj.merge(r,e),t.ready((()=>{this.player.addClass("vjs-quality-selector-hls"),this.player.qualityLevels&&(this.createQualityButton(),this.bindPlayerEvents())}))}getHls(){return this.player.tech({IWillNotUseThisInPlugins:!0}).hls}bindPlayerEvents(){this.player.qualityLevels().on("addqualitylevel",this.onAddQualityLevel.bind(this))}createQualityButton(){const t=this.player;this._qualityButton=new a(t);const e=t.controlBar.children().length-2,i=t.controlBar.addChild(this._qualityButton,{componentClass:"qualitySelector"},this.config.placementIndex||e);if(i.addClass("vjs-quality-selector"),this.config.displayCurrentQuality)this.setButtonInnerText("auto");else{const t=` ${this.config.vjsIconClass||"vjs-icon-hd"}`;i.menuButton_.$(".vjs-icon-placeholder").className+=t}i.removeClass("vjs-hidden")}setButtonInnerText(t){this._qualityButton.menuButton_.$(".vjs-icon-placeholder").innerHTML=t}getQualityMenuItem(t){return function(t,e,i,l){const s=new o(t,{label:e.label,selectable:!0,selected:e.selected||!1});return s.item=e,s.qualityButton=i,s.plugin=l,s.handleClick=function(){for(let t=0;t<this.qualityButton.items.length;++t)this.qualityButton.items[t].selected(!1);this.plugin.setQuality(this.item.value),this.selected(!0)},s}(this.player,t,this._qualityButton,this)}onAddQualityLevel(){const t=this.player,e=t.qualityLevels().levels_||[],i=[];for(let t=0;t<e.length;++t){const{width:l,height:s}=e[t],n=Math.min(l,s);if(n&&!i.filter((t=>t.item&&t.item.value===n)).length){const t=this.getQualityMenuItem({label:n+"p",value:n});i.push(t)}}i.sort(((t,e)=>e.item.value-t.item.value));const l=this.getQualityMenuItem({label:t.localize("Auto"),value:"auto",selected:!0});i.unshift(l),this._qualityButton&&(this._qualityButton.createItems=function(){return i},this._qualityButton.update())}setQuality(t){const e=this.player.qualityLevels().levels_||[];this._currentQuality=t,this.config.displayCurrentQuality&&this.setButtonInnerText("auto"===t?this.player.localize("Auto"):`${t}p`);let i=!1;if(e.forEach((e=>{const l=Math.min(e.width,e.height);"auto"===t||l===t?(e.enabled=!0,i=!0):e.enabled=!1})),this._qualityButton.unpressButton(),i){const t=this.player.currentTime(),e=this.player.volume(),i=!this.player.paused();this.player.pause();const l=this.player.tech();if(l&&"function"==typeof l.clearBuffer)l.clearBuffer();else{const e=t>.1?t-.1:0;this.player.currentTime(e)}setTimeout((()=>{this.player.currentTime(t),this.player.volume(e),i&&this.player.play()}),50)}}getCurrentQuality(){return this._currentQuality||"auto"}}const c=function(t){return function(t,e){const i=new h(t,e);return t.QualitySelectorHlsVjs=!0,i.defaultState={},i.VERSION="1.1.1",i}(this,i.default.obj.merge({},t))};return i.default.registerPlugin("qualitySelectorHls",c),c}));
